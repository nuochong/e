<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JS代码脏乱差？你需要知道这些优化技巧 | 小窝</title>
    <meta name="description" content="博客">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="/favicon/favicon.ico">
  <meta name="theme-color" content="#fff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/favicon/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#fff">
  <meta name="msapplication-TileImage" content="/favicon/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="stylesheet" href="https://at.alicdn.com/t/font_1575342_gu630lpigw.css" type="text/css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.11.0/baguetteBox.min.css" type="text/css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.1/css/swiper.min.css" type="text/css">
  <link rel="stylesheet" href="https://cdn.bootcss.com/animate.css/3.7.2/animate.min.css" type="text/css">
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v1.7.0/mapbox-gl.css" type="text/css">
  <link rel="stylesheet" href="https://www.zhangxinxu.com/study/201903/css-idea/cssgram.min.css" type="text/css">
  <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.firebase.com/js/client/2.0.4/firebase.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.1/js/swiper.min.js"></script>
  <script src="https://static.runoob.com/assets/qrcode/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/shakee93/vue-toasted@v1.1.27/dist/vue-toasted.min.js"></script>
  <script src="https://cdn.bootcss.com/wow/1.1.2/wow.min.js"></script>
  <script src="https://cdn.bootcss.com/velocity/2.0.5/velocity.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/locale/zh-cn.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/v1.7.0/mapbox-gl.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-language/v0.10.1/mapbox-gl-language.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/console-badge@1.3.0/dist/console-badge.umd.min.js"></script>
  <link rel="alternate" type="application/rss+xml" href="https://luzhaoyang.com/rss.xml" title=" RSS Feed">
  <link rel="alternate" type="application/atom+xml" href="https://luzhaoyang.com/feed.atom" title=" Atom Feed">
  <link rel="alternate" type="application/json" href="https://luzhaoyang.com/feed.json" title=" JSON Feed">
    <meta property="article:published_time" content="Sun Feb 17 2019 19:34:00 GMT+0800 (GMT+08:00)"><meta property="article:modified_time" content="Sun Feb 17 2019 19:34:00 GMT+0800 (GMT+08:00)"><meta property="og:title" content="JS代码脏乱差？你需要知道这些优化技巧"><meta property="og:type" content="website"><meta property="og:url" content="https://luzhaoyang.com/zh/posts/js-dai-ma-zang-luan-chai-ni-xu-yao-zhi-dao-zhe-xie-you-hua-ji-qiao.html"><meta property="og:image" content="https://luzhaoyang.com/social/image-social-share-zh.png"><meta name="twitter:title" content="JS代码脏乱差？你需要知道这些优化技巧"><meta name="twitter:url" content="https://luzhaoyang.com/zh/posts/js-dai-ma-zang-luan-chai-ni-xu-yao-zhi-dao-zhe-xie-you-hua-ji-qiao.html"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://luzhaoyang.com/social/image-social-share-zh.png"><meta name="twitter:label2" content="Filed under"><meta name="twitter:data2" content="前端开发"><meta property="article:tag" content="前端开发">
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/styles.d57c347f.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/app.d57c347f.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/20.styles.d51247cd.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/20.d51247cd.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/4.styles.2b333221.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/4.2b333221.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/19.styles.ddff1d59.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/19.ddff1d59.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/18.styles.34573ff4.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/18.34573ff4.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/26.styles.41ac749a.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/26.41ac749a.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/0.styles.97d58b67.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/0.97d58b67.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/5.18be1cd5.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/3.styles.833a573c.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/3.833a573c.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/23.styles.d4bf616e.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/23.d4bf616e.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/79.5042282d.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/6.styles.4751d3a1.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/6.4751d3a1.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/13.styles.1bfcb06f.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/13.1bfcb06f.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/1.styles.c9ab3064.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/1.c9ab3064.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/11.styles.4fde8942.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/11.4fde8942.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/21.styles.fb3560a3.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/21.fb3560a3.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/2.styles.245fd20f.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/2.245fd20f.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/27.styles.fe9fba84.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/27.fe9fba84.js" as="script"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/10.styles.cabf49e1.css"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/12.styles.80c60f61.css"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/14.styles.9a0c3af4.css"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/15.styles.edf80c37.css"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/16.styles.75d968a4.css"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/17.styles.696b0212.css"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/22.styles.49f2a1f9.css"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/24.styles.a01c64f5.css"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/25.styles.2cec816f.css"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/31.styles.10eabb18.css"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/7.styles.2ebaaee2.css"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/10.cabf49e1.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/100.2eb57c0f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/101.002eaa7e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/102.b9c76942.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/103.87994189.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/104.95566dfd.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/105.430575fd.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/106.300195f9.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/107.3dae6e4c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/108.d8e4a49d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/109.e7d4c25b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/110.ba28f0d7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/111.97764f84.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/112.cbb6bb1f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/113.53b88b5a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/114.51a748df.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/115.e069c8e7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/116.92bfff79.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/117.e76336ef.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/118.c2ba4f34.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/119.0aea3458.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/12.80c60f61.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/120.19a4c5f7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/121.e5464f16.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/122.4ced56d3.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/123.f8a4e673.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/124.f83f810d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/125.8a2208bf.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/126.a843736e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/127.dd287357.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/128.2087c5ad.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/129.5dc96ccb.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/130.93c9c341.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/131.3aa1f935.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/132.ea291239.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/133.ec00ef72.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/134.88871d41.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/135.cdd7d667.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/136.03322976.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/137.f0b3e2b4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/138.2cf83d61.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/139.d4f441e9.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/14.9a0c3af4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/140.0450bd2e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/141.6cb95dd1.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/15.edf80c37.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/16.75d968a4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/17.696b0212.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/22.49f2a1f9.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/24.a01c64f5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/25.2cec816f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/28.464916e9.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/29.49ef14ec.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/30.148ad653.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/31.10eabb18.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/32.12d687c3.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/33.c801b90b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/34.da050b18.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/35.7ef46372.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/36.da5dc7c0.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/37.51d1a17c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/38.07083992.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/39.ef05f70d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/40.df52b5a4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/41.6c85fb01.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/42.f15089da.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/43.3c7754c7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/44.b57f69e2.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/45.0c640b2a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/46.94333b89.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/47.e1a1225d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/48.2bf09f00.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/49.cea53355.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/50.2a57a7ff.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/51.8092b81a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/52.2b61e773.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/53.2e2e53b1.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/54.009580a5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/55.de9fddee.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/56.eded1adb.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/57.ec0f8eea.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/58.9ab2cf64.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/59.6ce24004.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/60.e36cb218.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/61.ec5695ae.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/62.d1b8aab8.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/63.40325cf5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/64.47128400.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/65.a078938f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/66.4e31be00.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/67.ef9560e2.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/68.9e1e63a4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/69.89b2e6b5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/7.2ebaaee2.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/70.470b6ca5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/71.d150f72b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/72.ac17510f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/73.94f0f447.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/74.28030446.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/75.f35ad64d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/76.adc04f77.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/77.8da33491.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/78.041215f0.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/80.c1a2dd2b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/81.4919b394.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/82.67a3d049.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/83.406bbb51.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/84.fd603a57.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/85.bbf0e628.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/86.02db2017.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/87.231cc7a3.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/88.073b6e25.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/89.5dea3afb.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/90.52338e38.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/91.9d6e20a9.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/92.ca04234e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/93.99e750be.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/94.84c4db09.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/95.08d49fb7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/96.6ce05d6b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/97.bd5d1557.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/98.858dde48.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/99.10204500.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/vendors~flowchart.2e01b395.js">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/styles.d57c347f.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/20.styles.d51247cd.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/4.styles.2b333221.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/19.styles.ddff1d59.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/18.styles.34573ff4.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/26.styles.41ac749a.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/0.styles.97d58b67.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/3.styles.833a573c.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/23.styles.d4bf616e.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/6.styles.4751d3a1.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/13.styles.1bfcb06f.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/1.styles.c9ab3064.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/11.styles.4fde8942.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/21.styles.fb3560a3.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/2.styles.245fd20f.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/css/27.styles.fe9fba84.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div itemscope="itemscope" itemtype="https://schema.org/WebPage" class="layout-main"><meta itemprop="name" content=""> <meta itemprop="alternateName" content=""> <meta itemprop="url" content="https://luzhaoyang.com"> <nav aria-label="Navigation" itemscope="itemscope" itemtype="https://schema.org/SiteNavigationElement" class="container nav-mobile not-black" style="display:none;"><span itemprop="headline" class="nav-mobile__title not-black">导航</span> <ul class="nav-mobile__list not-black"><li class="nav-mobile__item not-black"><a href="/zh/categories/" itemprop="url" class="nav-mobile__link not-black"><span class="bullet no_bw bullet--primary bullet--normal"></span> <span class="text not-black">文章分类</span></a></li><li class="nav-mobile__item not-black"><a href="/zh/gallery/" itemprop="url" class="nav-mobile__link not-black"><span class="bullet no_bw bullet--primary bullet--normal"></span> <span class="text not-black">摄影相册</span></a></li><li class="nav-mobile__item not-black"><a href="/zh/comments/" itemprop="url" class="nav-mobile__link not-black"><span class="bullet no_bw bullet--primary bullet--normal"></span> <span class="text not-black">我的留言</span></a></li><li class="nav-mobile__item not-black"><a href="/zh/travel/" itemprop="url" class="nav-mobile__link not-black"><span class="bullet no_bw bullet--primary bullet--normal"></span> <span class="text not-black">旅行简记</span></a></li><li class="nav-mobile__item not-black"><a href="/zh/about/" itemprop="url" class="nav-mobile__link not-black"><span class="bullet no_bw bullet--primary bullet--normal"></span> <span class="text not-black">关于我们</span></a></li><li class="nav-mobile__item not-black"><a href="/zh/contact/" itemprop="url" class="nav-mobile__link not-black"><span class="bullet no_bw bullet--primary bullet--normal"></span> <span class="text not-black">联系我们</span></a></li><li class="nav-mobile__item not-black"><a href="/zh/categories/backend.html" itemprop="url" class="nav-mobile__link not-black"><span class="bullet no_bw bullet--primary bullet--normal"></span> <span class="text not-black">后端开发</span></a></li><li class="nav-mobile__item not-black"><a href="/zh/categories/frontend.html" itemprop="url" class="nav-mobile__link not-black"><span class="bullet no_bw bullet--primary bullet--normal"></span> <span class="text not-black">前端开发</span></a></li><li class="nav-mobile__item not-black"><a href="/zh/categories/other.html" itemprop="url" class="nav-mobile__link not-black"><span class="bullet no_bw bullet--primary bullet--normal"></span> <span class="text not-black">其他记录</span></a></li><li class="nav-mobile__item not-black"><a href="/zh/categories/travel.html" itemprop="url" class="nav-mobile__link not-black"><span class="bullet no_bw bullet--primary bullet--normal"></span> <span class="text not-black">旅行生活</span></a></li></ul></nav> <div class="container-fluid wrapper-body__nm"><header itemscope="itemscope" itemtype="https://schema.org/Organization" class="header"><!----> <div class="row header-top"><div class="column xs-33 sm-20"><div class="hamburguer header-top__hamburguer"><div class="hamburguer__wrapper"><span class="hamburguer__line"></span> <span class="hamburguer__line"></span> <span class="hamburguer__line"></span></div></div> <div class="languages header-top__languages"><div class="languages__box"><span class="languages__title meta-text">ZH</span> <span class="languages__icon"></span></div> <ul class="languages__list"><li class="languages__item"><a href="/" class="languages__link router-link-active">
        English
      </a></li><li class="languages__item"><a href="/zh/posts/js-dai-ma-zang-luan-chai-ni-xu-yao-zhi-dao-zhe-xie-you-hua-ji-qiao.html" class="languages__link router-link-exact-active router-link-active">
        Chinese
      </a></li></ul></div></div> <div class="column xs-33 sm-60"><div class="header__logo"><a href="/zh/" itemprop="url" class="header-top-logo__link router-link-active"><img itemprop="logo" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAAAyCAMAAAD7sXLbAAABDlBMVEUAAAA0SV00SFw0SF40SV40SF40SF0wQGA1SF2u6eau1dQ0SF01RVq+0tbfcZSuxsqwx8qtwcYzSF6y5d4wSGDpdJis3dmwztE1SV40SF2ntMCz4980R16tzs/TbpGov8Wxu8PDa4qtwcQ0SV3GaYqnu8Go0tKxv8avZII1SF2+ztS6z9XzeZ41SV6p7ubwdprki6ep6+Sx392r5+Ku5OBafok9Vmk5SV/EwcnNscDbmbF5qq/ohqTmc5eKXHh0WHJoVG670NOT0M2Gvr5ok5vWb5LLbY7AaYq1Z4erZIRGY3NuVnBDTGKg49y219eV0s+PyceMxsXJt8JwnaPUh6Lse51iiJKhYoBNbHtcUWoRJ6B1AAAALXRSTlMAwECA7+C/EJ8N828wH/3f1KBfNSD+9PPPsEwb8O7e27iUk4+BgH5sZmBTMBV50rNAAAABnUlEQVRIx42U51rCMBSGYymljAICMsS9V1paCihDEBFUcO/7vxEreTBtZt+ffd4m3zknCZiT06JQrSggHKkyRGhKKF1Fdtg/otCPXpDoEUgQiQl9FZKoSYGuQAZRfhnHkIlWkMUXlyH3oZpj+UuQj5YS+zR6TOLTvaV8CWVF4MtDyXXcKbmPOyXz6fFJ/O9R4544UwK/eW16PHQaTfxtV+B7OsJ+fvvfRuf6DdPP02IbhfJnk974awCHJoH9MvJ+qZB+68b6491kMex8xgn/0ppzYXLIE34a+U5If4D0msmDyHMniVMM1tvqIf+R5x8E/SnSuzw9QcxLEqdYRT6OI+pOfZl8baei7iQM6j7eIv+VszjpzyyES+vrBsA+cRbalO3s0+8DPgtXpL4ZByy/z67WPQQB9IU/Qf55UM/GOe/zD2u2iVXuez6ml3d3AE2STo+jMFDwPcTNwVEoCv7Rtql50kTxqD4cZNvZKuCSRNcQF2tnToGA2Fp/xZ8mYwAxRxaiVvfs0gmQsjdfv+t6SfIgDGfbG+maU9oy5Oov1sAUptGGixIAAAAASUVORK5CYII=" srcset="/logo/ktquez-play-logo.png 1x, /logo/ktquez-play-logo@2x.png 2x" alt="小窝"></a></div> <meta itemprop="name" content=""> </div> <div class="column xs-33 sm-20"><div class="search header-top__search"><!----> <span class="icon search__icon icon-search"></span></div> <div class="switch-bw header-top__toggle"><span class="switch-bw__text">
    开启夜间模式
  </span> <label for="switch-bw" class="switch-bw__label"><input type="checkbox" id="switch-bw" name="switch-bw" aria-labelledby="switch-bw-text" class="switch-bw__input"> <span class="switch-bw__ball"></span> <span id="switch-bw-text" hidden="hidden">switch to black or white</span></label></div></div></div></header> <main id="main" itemscope="itemscope" itemtype="https://schema.org/Blog" class="main-page"><div><a href="#main" class="vue-skip-to">跳到主要内容</a> <div><div class="page page__full row justify-right"><article itemscope="itemscope" itemprop="blogPost" itemtype="https://schema.org/BlogPosting" class="column xs-100 page__full__box box-default"><meta itemprop="mainEntityOfPage" content="/zh/posts/js-dai-ma-zang-luan-chai-ni-xu-yao-zhi-dao-zhe-xie-you-hua-ji-qiao.html"> <header class="page-header page__full-header"><button type="button" class="ui-button reset-button back-button"><span class="icon back-button__icon icon--arrow icon-arrow"></span> <span class="back-button__text">返回</span></button> <div class="page-header__meta"><time datetime="Sun Feb 17 2019 19:34:00 GMT+0800 (GMT+08:00)" itemprop="datePublished" class="text">
            </time> <meta itemprop="dateModified" content="currentPost.updated_at"> <!----></div> <h1 itemprop="name headline" class="page-header__title">JS代码脏乱差？你需要知道这些优化技巧</h1> <div class="page-header-cat"><nav class="page-header-cat__nav"><ul class="page-header-cat__list"><li class="page-header-cat__item"><a href="/zh/categories/frontend.html" itemprop="keywords" class="page-header-cat__link meta-text">
                  前端开发
                </a></li></ul></nav></div> <div itemprop="author" itemscope="itemscope" itemtype="https://schema.org/Person" class="page-header__author"><strong>作者: </strong> <a href="/zh/authors/nuochong.html" rel="author" itemprop="url" class="link link--filler-s-primary"><span itemprop="name" class="not-black">诺冲</span></a></div></header> <!----> <!----> <section class="page-content page__full-content"><div class="row"><div class="column no-pad-l sm-50 post-share"><div class="observer" data-v-e3cf7e50><!----> <!----> <!----></div></div> <!----></div> <div class="row"><div class="column no-pad-l md-75 xl-67 post-content"><div class="post-content__box-player"><!----></div> <div class="post-content__excerpt"><!----></div> <div class="post-content__table-contents"><div class="table-contents"><h3 id="table-of-content" class="table-contents__title">目录</h3> <nav><ol class="table-contents__list"><li class="table-contents__item"><a href="#javascript-的力量就像核能" title="JavaScript 的力量就像核能" class="table-contents__link"><span>JavaScript 的力量就像核能</span></a></li><li class="table-contents__item"><a href="#代码可靠性" title="代码可靠性" class="table-contents__link"><span>代码可靠性</span></a></li><li class="table-contents__item"><a href="#内存不足" title="内存不足" class="table-contents__link"><span>内存不足</span></a></li><li class="table-contents__item"><a href="#初学者的注意事项" title="初学者的注意事项" class="table-contents__link"><span>初学者的注意事项</span></a></li><li class="table-contents__item"><a href="#工具" title="工具" class="table-contents__link"><span>工具</span></a></li><li class="table-contents__item"><a href="#eslint-配置" title="ESLint 配置" class="table-contents__link"><span>ESLint 配置</span></a></li><li class="table-contents__item"><a href="#重构的重要性" title="重构的重要性" class="table-contents__link"><span>重构的重要性</span></a></li><li class="table-contents__item"><a href="#复杂度的最大源头" title="复杂度的最大源头" class="table-contents__link"><span>复杂度的最大源头</span></a></li><li class="table-contents__item"><a href="#长文件" title="长文件" class="table-contents__link"><span>长文件</span></a></li><li class="table-contents__item"><a href="#长函数" title="长函数" class="table-contents__link"><span>长函数</span></a></li><li class="table-contents__item"><a href="#复杂函数" title="复杂函数" class="table-contents__link"><span>复杂函数</span></a></li><!----><li class="table-contents__item"><a href="#可变状态" title="可变状态" class="table-contents__link"><span>可变状态</span></a></li><!----><!----><li class="table-contents__item"><a href="#不要-push-数组" title="不要 push 数组" class="table-contents__link"><span>不要 push 数组</span></a></li><!----><li class="table-contents__item"><a href="#不变性" title="不变性" class="table-contents__link"><span>不变性</span></a></li><!----><li class="table-contents__item"><a href="#面向对象编程" title="面向对象编程" class="table-contents__link"><span>面向对象编程</span></a></li><!----><!----><!----><li class="table-contents__item"><a href="#信噪比" title="信噪比" class="table-contents__link"><span>信噪比</span></a></li><li class="table-contents__item"><a href="#this-关键字" title="This 关键字" class="table-contents__link"><span>This 关键字</span></a></li><!----><li class="table-contents__item"><a href="#声明式编程需要努力才能熟练" title="声明式编程需要努力才能熟练" class="table-contents__link"><span>声明式编程需要努力才能熟练</span></a></li><li class="table-contents__item"><a href="#优先从函数返回对象" title="优先从函数返回对象" class="table-contents__link"><span>优先从函数返回对象</span></a></li><li class="table-contents__item"><a href="#控制执行流程中的异常" title="控制执行流程中的异常" class="table-contents__link"><span>控制执行流程中的异常</span></a></li><!----><!----><!----><!----><!----><li class="table-contents__item"><a href="#部分应用函数" title="部分应用函数" class="table-contents__link"><span>部分应用函数</span></a></li><li class="table-contents__item"><a href="#几个小技巧" title="几个小技巧" class="table-contents__link"><span>几个小技巧</span></a></li><!----><!----><!----><!----><li class="table-contents__item"><a href="#总结" title="总结" class="table-contents__link"><span>总结</span></a></li></ol></nav></div></div> <div itemprop="articleBody"><div class="content__default"><p>JavaScript 是万众瞩目的力量。它是世界上最流行的编程语言。它容易理解，有丰富的学习资源，对初学者非常友好。JavaScript 有着庞大的资源库，对小公司和大企业都颇具吸引力。庞大的 JS 工具和库生态系统为开发者的生产力带来了福音。只用 JS 一种语言就能统一前端和后端，于是就可以在整个技术栈中使用同一套技能组合。</p> <h2 id="javascript-的力量就像核能"><a href="#javascript-的力量就像核能" class="header-anchor">#</a> JavaScript 的力量就像核能</h2> <p>JavaScript 提供了许多工具和选项，但它对开发者几乎没有任何限制。让没有经验的人使用 JavaScript，就像是给一个两岁的孩子一盒火柴和一罐汽油一样…</p> <p>JavaScript 的力量就像核能——既可以用来为城市供电，也可以用来摧毁一切。用 JavaScript 构建东西很容易。但构建既可靠又易维护的软件就不是什么轻松的事情了。</p> <h2 id="代码可靠性"><a href="#代码可靠性" class="header-anchor">#</a> 代码可靠性</h2> <p>在建造大坝时，工程师首先关注的是可靠性。在没有任何规划或安全措施的前提下修建大坝是很危险的。建造桥梁、生产飞机、汽车… 都是一回事。如果汽车不安全不可靠，那么像马力、引擎响声，还是内饰中使用的皮革类型这些都无关紧要了。</p> <p>同样，每位软件开发者的目标都是编写可靠的软件。如果代码有缺陷且不可靠，那么其他问题都是小巫见大巫了。编写可靠代码的最佳方法是什么？那就是写出简洁的代码。简单的反面是复杂。因此软件开发者首要的责任应该是降低代码的复杂度。</p> <p>开发者经验丰富的标志就是能编写可靠的软件。可靠性还包括可维护性——只有可维护的代码库才是可靠的。</p> <p>虽然我是函数式编程的坚定信徒，但我不会安利什么内容。我只是会从函数式编程中引用一些概念，并演示如何在 JavaScript 中应用它们。</p> <p>我们真的需要软件可靠性吗？这取决于你自己。有些人认为客户能凑合用软件就行了，我不敢苟同。事实上，如果软件不可靠且难以维护，那么其他问题根本就不重要了。谁会购买一辆随机刹车和加速的汽车呢？谁会希望自己的手机每天断线几次，随机重启呢？</p> <h2 id="内存不足"><a href="#内存不足" class="header-anchor">#</a> 内存不足</h2> <p>我们怎样开发可靠的软件？</p> <p>首先考虑可用内存的大小。我们的程序应该尽量节约内存，永远不会耗尽所有可用内存，以避免性能下降。</p> <p>这和编写可靠的软件有什么关系？人类的大脑也有自己的内存，叫做工作记忆。我们的大脑是宇宙中已知最强大的机器，但它有自己的一套限制——我们只能在工作记忆中保存大约五条信息。</p> <p>对于编程工作来说，这意味着简单的代码消耗的脑力资源更少，进而提升我们的效率，并产出更可靠的软件。本文和一些 JavaScript 工具将帮助你实现这一目标！</p> <h2 id="初学者的注意事项"><a href="#初学者的注意事项" class="header-anchor">#</a> 初学者的注意事项</h2> <p>本文中我将大量使用 ES6 函数。简单回顾一下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ---------------------------------------------</span>
<span class="token comment">// lambda (fat arrow) anonymous functions</span>
<span class="token comment">// ---------------------------------------------</span>
<span class="token keyword">const</span> <span class="token function-variable function">doStuff</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token comment">// same as:</span>
<span class="token keyword">function</span> <span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
<span class="token comment">// ---------------------------------------------</span>
<span class="token comment">// object destructuring</span>
<span class="token comment">// ---------------------------------------------</span>
<span class="token keyword">const</span> <span class="token function-variable function">doStuff</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// same as:</span>
<span class="token keyword">const</span> <span class="token function-variable function">doStuff</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// same as:</span>
<span class="token keyword">const</span> <span class="token function-variable function">doStuff</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ---------------------------------------------</span>
<span class="token comment">// array destructuring</span>
<span class="token comment">// ---------------------------------------------</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// same as:</span>
<span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="工具"><a href="#工具" class="header-anchor">#</a> 工具</h2> <p>JavaScript 的最大优势之一是丰富的可用工具。没有其他哪种编程语言有如此庞大的工具和库生态系统。</p> <p>我们应该充分利用这些工具，尤其是 ESLint（<a href="https://eslint.org/%EF%BC%89%E3%80%82ESLint" target="_blank" rel="noopener noreferrer">https://eslint.org/）。ESLint<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是静态代码分析工具，可以找到代码库中潜在的问题，维持代码库的高质量。而且 linting 是一个完全自动化的过程，可以防止低质量代码进入代码库。</p> <p>很多人没能充分利用 ESLint——他们只用了预建配置，如 eslint-config-airbnb 而已。很可惜这只是 ESlint 的皮毛。JavaScript 是一种没有限制的语言。而 linting 设置不当会带来深远的影响。</p> <p>熟练的开发者不仅知道该用哪些函数，还会知道不应该使用哪些 JS 函数。JavaScript 是一种古老的语言，有很多包袱，所以区分好坏是很重要的。</p> <h2 id="eslint-配置"><a href="#eslint-配置" class="header-anchor">#</a> ESLint 配置</h2> <p>你可以按如下方式设置 ESLint。我建议逐一熟悉这些建议，并将 ESLint 规则逐一纳入你的项目中。先将它们配置为 warn，习惯了可以将一些规则转为 error。
在项目的根目录中运行：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i -D eslint
<span class="token function">npm</span> i -D eslint-plugin-fp
</code></pre></div><p>然后在项目的根目录中创建一个.eslintrc.yml 文件：</p> <div class="language- extra-class"><pre class="language-text"><code>env:
  es6: true
plugins:
  fp
rules:
  # rules will go in here
</code></pre></div><p>如果你使用的是像 VSCode 这样的 IDE，请安装 ESLint 插件。</p> <p>你还可以从命令行手动运行 ESLint：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>npx eslint <span class="token builtin class-name">.</span>
</code></pre></div><h2 id="重构的重要性"><a href="#重构的重要性" class="header-anchor">#</a> 重构的重要性</h2> <p>重构是降低现有代码复杂度的过程。如果使用得当，它将成为我们对付可怕的技术债务怪物的最佳武器。如果没有持续的重构，技术债务将不断积累，反过来又会拖累开发者。</p> <p>重构就是清理现有代码，同时确保代码仍能正常运行的过程。重构是软件开发中的良好实践，是健康组织中开发流程的一部分。</p> <p>需要注意的是，在重构之前最好将代码纳入自动化测试。重构时很容易在无意中破坏现有功能，全面的测试套件是预防潜在风险的好办法。</p> <h2 id="复杂度的最大源头"><a href="#复杂度的最大源头" class="header-anchor">#</a> 复杂度的最大源头</h2> <p>这可能听起来很奇怪，但代码本身就是复杂度的最大源头。实际上 NoCode 就是编写安全可靠软件的最佳途径。但很多时候我们做不到 NoCode，所以备选答案就是减少代码量。更少的代码意味着更少的复杂度，也意味着产生错误的潜在区域更少。有人说初级开发者编写代码，而高级开发者删除代码——不能同意更多。</p> <h2 id="长文件"><a href="#长文件" class="header-anchor">#</a> 长文件</h2> <p>人类是懒惰的。懒惰是一种短期生存策略，舍弃对生存不重要的事物来节省能量。</p> <p>有些人很懒，不守规矩。人们将越来越多的代码放入同一个文件中… 如果文件的长度没有限制，那么这些文件往往会无限增长下去。根据我的经验，超过 200 行代码的文件就太难理解、太难维护了。长文件还意味着程序可能处理的工作太多了，违反了单一责任原则。</p> <p>怎么解决这个问题？只需将大文件分解为更细粒度的模块即可。</p> <p>建议的 ESLint 配置：</p> <div class="language- extra-class"><pre class="language-text"><code>rules:
  max-lines:
  - warn
  - 200
</code></pre></div><h2 id="长函数"><a href="#长函数" class="header-anchor">#</a> 长函数</h2> <p>复杂度的另一大来源是漫长而复杂的函数，很难推理；而且函数的职责太多，很难测试。</p> <p>例如下面的 express.js 代码片段是用来更新博客条目的：</p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/api/blog/posts/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>title<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      error<span class="token operator">:</span> <span class="token string">'title is required'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      error<span class="token operator">:</span> <span class="token string">'text is required'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> postId <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> blogPost<span class="token punctuation">;</span>
  <span class="token keyword">let</span> postIndex<span class="token punctuation">;</span>
  blogPosts<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">post<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>post<span class="token punctuation">.</span>id <span class="token operator">===</span> postId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      blogPost <span class="token operator">=</span> post<span class="token punctuation">;</span>
      postIndex <span class="token operator">=</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>blogPost<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      error<span class="token operator">:</span> <span class="token string">'post not found'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> updatedBlogPost <span class="token operator">=</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> postId<span class="token punctuation">,</span>
    title<span class="token operator">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
    text<span class="token operator">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>text
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  blogPosts<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>postIndex<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> updatedBlogPost<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    updatedBlogPost
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>函数体长度为 38 行，执行以下操作：分析 post id、查找现有博客帖子、验证用户输入、在输入无效的情况下返回验证错误、更新帖子集合，并返回更新的博客帖子。</p> <p>显然它可以重构为一些较小的函数。路由处理程序可能看起来像这样：</p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/api/blog/posts/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> error<span class="token operator">:</span> validationError <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">validateInput</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>validationError<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">errorResponse</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> validationError<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> blogPost <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">findBlogPost</span><span class="token punctuation">(</span>blogPosts<span class="token punctuation">,</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> error<span class="token operator">:</span> postError <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">validateBlogPost</span><span class="token punctuation">(</span>blogPost<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>postError<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">errorResponse</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> postError<span class="token punctuation">,</span> <span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> updatedBlogPost <span class="token operator">=</span> <span class="token function">buildUpdatedBlogPost</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">updateBlogPosts</span><span class="token punctuation">(</span>blogPosts<span class="token punctuation">,</span> updatedBlogPost<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> updatedBlogPost <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>推荐的 ESLint 配置：</p> <div class="language- extra-class"><pre class="language-text"><code>rules:
  max-lines-per-function:
  - warn
  - 20
</code></pre></div><h2 id="复杂函数"><a href="#复杂函数" class="header-anchor">#</a> 复杂函数</h2> <p>复杂函数往往就是长函数，反之亦然。函数之所以变复杂可能有很多因素，但其中嵌套回调和圈复杂度较高都是比较容易解决的。</p> <p>嵌套回调往往导致回调地狱。可以用 promise 处理回调，然后使用 async-await 就能削弱其影响。</p> <p>来看一个带有深度嵌套回调的函数：</p> <div class="language-js extra-class"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error finding files: '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">filename<span class="token punctuation">,</span> fileIndex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">gm</span><span class="token punctuation">(</span>source <span class="token operator">+</span> filename<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> values</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error identifying file size: '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          aspect <span class="token operator">=</span> values<span class="token punctuation">.</span>width <span class="token operator">/</span> values<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
          widths<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>
            <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">width<span class="token punctuation">,</span> widthIndex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              height <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>width <span class="token operator">/</span> aspect<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>dest <span class="token operator">+</span> <span class="token string">'w'</span> <span class="token operator">+</span> width <span class="token operator">+</span> <span class="token string">'_'</span> <span class="token operator">+</span> filename<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error writing file: '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="圈复杂度"><a href="#圈复杂度" class="header-anchor">#</a> 圈复杂度</h3> <p>函数复杂度的另一大来源是圈复杂度。它指的是给定函数中的语句（逻辑）数，诸如 if 语句、循环和 switch 语句。这些函数很难推理，要尽量避免使用。这是一个例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>conditionA<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>conditionB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>conditionC<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>conditionD <span class="token operator">&amp;&amp;</span> conditionE <span class="token operator">||</span> conditionF<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>推荐的 ESLint 配置：</p> <div class="language- extra-class"><pre class="language-text"><code>rules:
  complexity:
  - warn
  - 5
  max-nested-callbacks:
  - warn
  - 2
  max-depth:
  - warn
  - 3
</code></pre></div><p>另一个降低代码复杂度的方法是声明式代码，稍后会具体展开。</p> <h2 id="可变状态"><a href="#可变状态" class="header-anchor">#</a> 可变状态</h2> <p>状态是存储在内存中的临时数据，例如对象中的变量或字面量。状态本身是无害的，但可变状态是软件复杂度的最大源头之一，与面向对象结合时尤其如此（稍后将详细介绍）。</p> <h3 id="人脑的局限"><a href="#人脑的局限" class="header-anchor">#</a> 人脑的局限</h3> <p>如前所述，人类大脑是宇宙中已知最强大的机器。然而我们的大脑很难应付状态，因为我们在工作记忆中一次只能容纳五件事情。我们很容易推理一段代码本身的作用，但涉及到它对代码库中变量的影响时就会糊涂了。</p> <p>使用可变状态编程容易让人精神错乱。只要放弃可变状态，我们的代码就能变得更加可靠。</p> <h3 id="可变状态的问题"><a href="#可变状态的问题" class="header-anchor">#</a> 可变状态的问题</h3> <p>举个例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">increasePrice</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> increaseBy</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// never ever do this</span>
  item<span class="token punctuation">.</span>price <span class="token operator">+=</span> increaseBy<span class="token punctuation">;</span>
  <span class="token keyword">return</span> item<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> oldItem <span class="token operator">=</span> <span class="token punctuation">{</span> price<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newItem <span class="token operator">=</span> <span class="token function">increasePrice</span><span class="token punctuation">(</span>oldItem<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// prints newItem.price 13</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'newItem.price'</span><span class="token punctuation">,</span> newItem<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// prints oldItem.price 13</span>
<span class="token comment">// unexpected?</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'oldItem.price'</span><span class="token punctuation">,</span> oldItem<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>错误很难看出来：我们改变函数参数时不小心修改了原始项目的价格。本来应该是 10，实际上改成了 13。</p> <p>我们构造和返回一个不可变的新对象来解决这个问题：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">increasePrice</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> increaseBy</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>item<span class="token punctuation">,</span>
  price<span class="token operator">:</span> item<span class="token punctuation">.</span>price <span class="token operator">+</span> increaseBy
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> oldItem <span class="token operator">=</span> <span class="token punctuation">{</span> price<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newItem <span class="token operator">=</span> <span class="token function">increasePrice</span><span class="token punctuation">(</span>oldItem<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// prints newItem.price 13</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'newItem.price'</span><span class="token punctuation">,</span> newItem<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// prints oldItem.price 10</span>
<span class="token comment">// as expected!</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'oldItem.price'</span><span class="token punctuation">,</span> oldItem<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>请记住，使用 ES6 spread 等运算符复制时会生成浅拷贝，而不是深拷贝——它不会复制任何嵌套属性。如果上面的 item 具有 <a href="http://item.seller.id" target="_blank" rel="noopener noreferrer">item.seller.id<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 这样的内容，则新 item 的 seller 仍将引用旧 item，这是不行的。在 JavaScript 中使用不可变状态时，一些较为稳健的方法包括 immutable.js 和 Ramda lense 等。我将在另一篇文章中介绍这些选项。</p> <p>建议的 ESLint 配置：</p> <div class="language- extra-class"><pre class="language-text"><code>rules:
  fp/no-mutation: warn
  no-param-reassign: warn
</code></pre></div><h2 id="不要-push-数组"><a href="#不要-push-数组" class="header-anchor">#</a> 不要 push 数组</h2> <p>在数组突变中使用像 push 这样的方法也存在同样的问题：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'apple'</span><span class="token punctuation">,</span> <span class="token string">'orange'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> a<span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'microsoft'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ['apple', 'orange', 'microsoft']</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ['apple', 'orange', 'microsoft']</span>
<span class="token comment">// unexpected?</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>数组 b 本应保持不变的。我们创建一个新数组而不是调用 push 就可以了。</p> <p>构造新数组来避免问题：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> newArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>a<span class="token punctuation">,</span> <span class="token string">'microsoft'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="不确定性"><a href="#不确定性" class="header-anchor">#</a> 不确定性</h3> <p>不确定性是说程序在输入不变的情况下输出却无法确定。明明 2 + 2 == 4，但不确定性程序不一定得出这个结果。</p> <p>虽然可变状态本身并不是不确定性的，但它会使代码更容易出现不确定性（如上所示）。讽刺的是最流行的编程范式（OOP 和命令式编程）特别容易产生不确定性。</p> <h2 id="不变性"><a href="#不变性" class="header-anchor">#</a> 不变性</h2> <p>想要避免可变性的缺陷，最好的方法就是改用不变性。不变性一个很大的话题，我可能会专门撰文讨论它。</p> <p>建议的 ESLint 配置：</p> <div class="language- extra-class"><pre class="language-text"><code>rules:
  fp/no-mutating-assign: warn
  fp/no-mutating-methods: warn
  fp/no-mutation: warn
</code></pre></div><h3 id="避免使用-let-关键字"><a href="#避免使用-let-关键字" class="header-anchor">#</a> 避免使用 Let 关键字</h3> <p>我们不应该用 var 在 JavaScript 中声明变量，同样我们也应该避免使用 let 关键字。用 let 声明的变量可以被重新分配，让代码更难推理。本质上这也是人脑工作记忆的一种限制。使用 let 关键字编程时，我们必须记住所有副作用和潜在的极端情况。我们可能不小心为变量分配一个不正确的值，结果就得浪费时间来调试了。</p> <p>单元测试受其影响最严重。多数测试都是并行开展的，所以在多个测试之间共享可变状态是一种灾难。</p> <p>let 关键字的替代方案当然是 const 关键字。虽然它不能保证不变性，但它会禁止重新分配，使代码更易推理。大多数情况下，重新给变量赋值的代码可以被提取到一个单独的函数中。来看一个例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> discount<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>isLoggedIn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cartTotal <span class="token operator">&gt;</span> <span class="token number">100</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isFriday<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    discount <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isValuedCustomer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    discount <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    discount <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  discount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>将同一个示例提取到一个函数中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">getDiscount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> isLoggedIn<span class="token punctuation">,</span> cartTotal<span class="token punctuation">,</span> isValuedCustomer <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLoggedIn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cartTotal <span class="token operator">&gt;</span> <span class="token number">100</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isFriday</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">30</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isValuedCustomer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">20</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>一开始不用 let 可能会不习惯，但这样代码会更简洁易懂。我很久没用 let 了，一点都不想它。</p> <p>养成不使用 let 关键字编程的习惯可以让你更有条理。你必须将代码分解为更小，更易于管理的函数组合，进而让函数的职责更清晰，更好地分离关注点，并使代码库更具可读性和可维护性。</p> <p>建议的 ESLint 配置：</p> <div class="language- extra-class"><pre class="language-text"><code>rules:
  fp/no-let: warn
</code></pre></div><h2 id="面向对象编程"><a href="#面向对象编程" class="header-anchor">#</a> 面向对象编程</h2> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>Java 是自 MS-DOS 以来计算行业最令人痛苦的事情。”
—— 名 Alan Kay，面向对象编程的发明者</p></div> <p>面向对象编程是一种用来组织代码的流行编程范例。本节会讨论 Java、C#、JavaScript、TypeScript 等语言中使用的主流 OOP 的局限。我不会批判正确的 OOP（例如 SmallTalk）。</p> <p>如果你认为在开发软件时必须使用 OOP，则可以跳过本节。</p> <h3 id="优秀程序员和普通程序员"><a href="#优秀程序员和普通程序员" class="header-anchor">#</a> 优秀程序员和普通程序员</h3> <p>优秀的程序员会编写好的代码，普通的程序员编写错误的代码，无论什么编程范式都是如此。编程范式要做的是防止普通的程序员搞出太多破坏。不管你愿不愿意，你都会和普通的程序员共事。可惜 OOP 没有足够的约束力来防止他们造成巨大的伤害。</p> <p>OOP 的初衷是帮助程序员打理代码库。讽刺的是人们认为 OOP 可以降低复杂度，但它提供的工具似乎只是在增加复杂度而已。</p> <h3 id="oop-不确定性"><a href="#oop-不确定性" class="header-anchor">#</a> OOP 不确定性</h3> <p>OOP 代码容易出现不确定性——它严重依赖可变状态，不像函数式编程那样可以保证输出不变，让代码更难推理。涉及并发时这种问题更为严重。</p> <h3 id="共享可变状态"><a href="#共享可变状态" class="header-anchor">#</a> 共享可变状态</h3> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>“我觉得用可变对象构建大型对象图会让面向对象的大型程序越来越复杂。你得试着理解并记住你在调用一种方法时会发生什么，副作用会是什么。“——Rich Hickey，Clojure 的创造者</p></div> <p>可变状态很棘手，而 OOP 共享可变状态的引用（而非值）的做法让这个问题更严重了。这意味着几乎任何东西都可以改变给定对象的状态。开发者必须牢记与当前对象交互的每个对象的状态，很快就会超过人脑工作记忆的上限。人脑要推理这种复杂的可变对象是极为困难的。它消耗了宝贵且有限的认知资源，并且不可避免地会导致大量缺陷。</p> <p>共享可变对象的引用是为了提高效率而做出的权衡，过去这可能还很合理。但如今硬件性能飞速提升，我们应该更加关注开发者的效率而不是代码的执行效率。而且有了现代工具的支持，不变性几乎不会影响性能。</p> <p>OOP 说全局状态是万恶之源。但讽刺的是 OOP 程序基本上就是一个大型全局状态（因为一切都是可变的并且通过引用共享）。</p> <p>最小知识原则没什么用途，只是鸵鸟政策而已——不管你怎样访问或改变一个状态，共享的可变状态仍然是共享的可变状态。领域驱动设计是一种有用的设计方法，能解决一些复杂度问题。但它仍然没有解决不确定性这个根本问题。</p> <h2 id="信噪比"><a href="#信噪比" class="header-anchor">#</a> 信噪比</h2> <p>很多人都在关注 OOP 程序的不确定性引入的复杂度。他们提出了许多设计模式试图解决这些问题。但这只是自欺欺人，并引入了更加不必要的复杂度。</p> <p>正如我之前所说，代码本身是复杂度的最大来源，代码总是越少越好。OOP 程序通常带有大量的样板代码，以及设计模式提供的“创可贴”，这些都会降低信噪比。这意味着代码变得更加冗长，人们更难看到程序的原始意图，使代码库变得非常复杂，不太可靠。</p> <p>我坚信现代 OOP 是软件复杂度的最大来源之一。的确有使用 OOP 构建的成功项目，但这并不意味着此类项目不会受无谓的复杂度影响。</p> <p>JavaScript 中的 OOP 尤其糟糕，因为这种语言缺少静态类型检查、泛型和接口等。JavaScript 中的 this 关键字相当不可靠。</p> <p>如果我们的目标是编写可靠的软件，那么我们应该努力降低复杂度，理想情况下应该避免使用 OOP。如果你有兴趣了解更多信息，请务必阅读我的另一篇文 “OOP，万亿美元的灾难”:
<a href="https://medium.com/@ilyasz/object-oriented-programming-the-trillion-dollar-disaster-%EF%B8%8F-92a4b666c7c7" target="_blank" rel="noopener noreferrer">https://medium.com/@ilyasz/object-oriented-programming-the-trillion-dollar-disaster-️-92a4b666c7c7<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="this-关键字"><a href="#this-关键字" class="header-anchor">#</a> This 关键字</h2> <p>this 关键字的行为总是飘忽不定。它很挑剔，在不同的环境中可能搞出来完全不同的东西。它的行为甚至取决于谁调用了一个给定的函数。使用 this 关键字经常会导致细小而奇怪的错误，很难调试。</p> <p>拿它做面试问题可能很有意思，但关于 this 关键字的知识其实也没什么意义，只能说明应聘者花了几个小时研究过最常见的 JavaScript 面试问题。</p> <p>真实世界的代码不应该那么容易出错，应该是可读的，不让人感到莫名其妙。This 是一个明显的语言设计缺陷，别再用它了。</p> <p>建议的 ESLint 配置：</p> <div class="language- extra-class"><pre class="language-text"><code>rules:
  fp/no-this: warn
</code></pre></div><p>声明式代码
声明式编程是一个流行术语，我们来看看它的实质和优点。</p> <p>如果你是编程老手，可能你一直在用命令式的编程风格，这种风格描述了一系列实现结果所需的步骤。相比之下声明式风格是描述期望的结果，而不是具体的步骤。</p> <p>典型的声明式语言有 SQL 和 HTML。甚至包括 React 中的 JSX！</p> <p>我们不会指定具体的步骤来告诉数据库如何获取数据，而是使用 SQL 来描述要获取的内容：</p> <div class="language- extra-class"><pre class="language-text"><code>SELECT * FROM Users WHERE Country='USA';
</code></pre></div><p>在命令式 JavaScript 中这样表示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> u <span class="token keyword">of</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span>country <span class="token operator">===</span> <span class="token string">'USA'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    user <span class="token operator">=</span> u<span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在声明式 JavaScript 中使用实验性流水线运算符（<a href="https://github.com/tc39/proposal-pipeline-operator%EF%BC%89%EF%BC%9A" target="_blank" rel="noopener noreferrer">https://github.com/tc39/proposal-pipeline-operator）：<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> filter<span class="token punctuation">,</span> first <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lodash/fp'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">filterByCountry</span> <span class="token operator">=</span> <span class="token parameter">country</span> <span class="token operator">=&gt;</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=&gt;</span> user<span class="token punctuation">.</span>country <span class="token operator">===</span> country<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> user <span class="token operator">=</span> users <span class="token operator">|</span><span class="token operator">&gt;</span> <span class="token function">filterByCountry</span><span class="token punctuation">(</span><span class="token string">'USA'</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">&gt;</span> first<span class="token punctuation">;</span>
</code></pre></div><p>我觉得第二种方法看起来更简洁，更具可读性。</p> <h3 id="优先使用表达式而非语句"><a href="#优先使用表达式而非语句" class="header-anchor">#</a> 优先使用表达式而非语句</h3> <p>编写声明式代码时应优先使用表达式而非语句。表达式始终返回一个值，而语句是用来执行操作的，不返回任何结果。这在函数式编程中也称为“副作用”。顺便说一句，前面讨论的状态突变也是副作用。</p> <p>常用的语句有 if、return、switch、for、while。</p> <p>来看一个简单的例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">calculateStuff</span> <span class="token operator">=</span> <span class="token parameter">input</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>input<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">superCalculator</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">dumbCalculator</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这可以很容易地重写为三元表达式（这是声明式的）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">calculateStuff</span> <span class="token operator">=</span> <span class="token parameter">input</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> input<span class="token punctuation">.</span>x <span class="token operator">?</span> <span class="token function">superCalculator</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">dumbCalculator</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>如果 lambda 函数中只有 return 语句，那么 JavaScript 也允许我们不用 lambda 语句：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">calculateStuff</span> <span class="token operator">=</span> <span class="token parameter">input</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>input<span class="token punctuation">.</span>x <span class="token operator">?</span> <span class="token function">superCalculator</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">dumbCalculator</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>函数长度从六行减到了一行。声明式编程太有用了！</p> <p>语句还会引起副作用和突变，进而产生不确定性，降低代码的可读性和可靠性。重新排序语句是不安全的，因为它们的执行依赖编写的顺序。语句（包括循环）难以并行化，因为它们在其作用域之外突变状态。使用语句会带来更多复杂度，进而产生额外的头脑负担。</p> <p>相比之下，表达式可以安全地重新排序，不会产生副作用，易于并行化。</p> <h2 id="声明式编程需要努力才能熟练"><a href="#声明式编程需要努力才能熟练" class="header-anchor">#</a> 声明式编程需要努力才能熟练</h2> <p>学习声明式编程不是一蹴而就的，尤其是多数人学的都是命令式编程。声明式编程需要全新的思维模式。要熟悉声明式编程，学习使用没有可变状态的程序是一个好的开始——既不用 let 关键字，也不改变状态。我可以肯定，熟悉声明式编程后你的代码会变得美观优雅。</p> <p>建议的 ESLint 配置：</p> <div class="language- extra-class"><pre class="language-text"><code>rules:
  fp/no-let: warn
  fp/no-loops: warn
  fp/no-mutating-assign: warn
  fp/no-mutating-methods: warn
  fp/no-mutation: warn
  fp/no-delete: warn
</code></pre></div><p>避免将多个参数传递给函数
JavaScript 不是静态类型语言，无法保证函数使用正确和符合预期的参数来调用。ES6 引入了许多出色的功能，解构对象就是其中之一，它也可用于函数参数。</p> <p>下面的代码很直观吗？你能立刻说出参数是什么吗？我反正不能。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> total <span class="token operator">=</span> <span class="token function">computeShoppingCartTotal</span><span class="token punctuation">(</span>itemList<span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token string">'USD'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>下面的例子呢？</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">computeShoppingCartTotal</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> itemList<span class="token punctuation">,</span> discount<span class="token punctuation">,</span> currency <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> total <span class="token operator">=</span> <span class="token function">computeShoppingCartTotal</span><span class="token punctuation">(</span><span class="token punctuation">{</span> itemList<span class="token punctuation">,</span> discount<span class="token operator">:</span> <span class="token number">10.0</span><span class="token punctuation">,</span> currency<span class="token operator">:</span> <span class="token string">'USD'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>显然后者比前者更具可读性。从不同模块发起的函数调用尤其符合这种情况。使用参数对象还能让参数不受编写顺序的影响。</p> <p>建议的 ESLint 配置：</p> <div class="language- extra-class"><pre class="language-text"><code>rules:
  max-params:
  - warn
  - 2
</code></pre></div><h2 id="优先从函数返回对象"><a href="#优先从函数返回对象" class="header-anchor">#</a> 优先从函数返回对象</h2> <p>下面这段代码的函数签名是什么？它返回了什么？是返回用户对象？用户 ID？操作状态？不看上下文很难回答。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">saveUser</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>从函数返回一个对象能明确开发者的意图，使代码更易读：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> user<span class="token punctuation">,</span> status <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">saveUser</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<span class="token keyword">const</span> <span class="token function-variable function">saveUser</span> <span class="token operator">=</span> <span class="token parameter">user</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    user<span class="token operator">:</span> savedUser<span class="token punctuation">,</span>
    status<span class="token operator">:</span> <span class="token string">&quot;ok&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="控制执行流程中的异常"><a href="#控制执行流程中的异常" class="header-anchor">#</a> 控制执行流程中的异常</h2> <p>我们经常会遇到莫名其妙的错误，错误信息什么细节都没有。虽说老师教我们在发生意外情况时抛出异常，但这并不是处理错误的最佳方法。</p> <h3 id="异常破坏了类型安全"><a href="#异常破坏了类型安全" class="header-anchor">#</a> 异常破坏了类型安全</h3> <p>即使在静态类型语言中，异常也会破坏类型安全性。根据其签名所示，函数 fetchUser(id: number): User 应该返回一个用户。函数签名没说如果找不到用户就抛出异常。如果需要异常，那么更合适的函数签名是：fetchUser(…): User|throws UserNotFoundError。当然这种语法在任何语言中都是无效的。</p> <p>推理程序的异常是很难的——人们可能永远不会知道函数是否会抛出异常。我们是可以把函数调用都包装在 try/catch 块中，但这不怎么实用，并且会严重影响代码的可读性。</p> <h3 id="异常破坏了函数组合"><a href="#异常破坏了函数组合" class="header-anchor">#</a> 异常破坏了函数组合</h3> <p>异常使函数组合难以利用。下面的例子中如果某篇帖子无法获取，服务器将返回 500 内部服务器错误。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">fetchBlogPost</span> <span class="token operator">=</span> <span class="token parameter">id</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> post <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/post/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>post<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Post with id </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> not found</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> post<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> html <span class="token operator">=</span> postIds <span class="token operator">|</span><span class="token operator">&gt;</span> <span class="token function">map</span><span class="token punctuation">(</span>fetchBlogPost<span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">&gt;</span> renderHTMLTemplate<span class="token punctuation">;</span>
</code></pre></div><p>如果其中一个帖子被删除，但由于一些模糊的 bug，用户仍然试图访问它怎么办？这将显著降低用户体验。</p> <h3 id="用元组处理错误"><a href="#用元组处理错误" class="header-anchor">#</a> 用元组处理错误</h3> <p>一种简单的错误处理方法是返回包含结果和错误的元组，而不是抛出异常。JavaScript 的确不支持元组，但可以使用 [error，result] 形式的双值数组很容易地模拟它们。顺便说一下，这也是 Go 中错误处理的默认方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">fetchBlogPost</span> <span class="token operator">=</span> <span class="token parameter">id</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> post <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/post/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> post
    <span class="token operator">?</span> <span class="token comment">// null for error if post was found</span>
      <span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">,</span> post<span class="token punctuation">]</span>
    <span class="token operator">:</span> <span class="token comment">// null for result if post was not found</span>
      <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Post with id </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> not found</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> blogPosts <span class="token operator">=</span> postIds <span class="token operator">|</span><span class="token operator">&gt;</span> <span class="token function">map</span><span class="token punctuation">(</span>fetchBlogPost<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> errors <span class="token operator">=</span>
  blogPosts
  <span class="token operator">|</span><span class="token operator">&gt;</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>err<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token operator">!</span>err<span class="token punctuation">)</span>  <span class="token comment">// keep only items with errors</span>
  <span class="token operator">|</span><span class="token operator">&gt;</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>err<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// destructure the tuple and return the error</span>
<span class="token keyword">const</span> html <span class="token operator">=</span>
  blogPosts
  <span class="token operator">|</span><span class="token operator">&gt;</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>err<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>err<span class="token punctuation">)</span>  <span class="token comment">// keep only items with no errors</span>
  <span class="token operator">|</span><span class="token operator">&gt;</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>_<span class="token punctuation">,</span> result<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> result<span class="token punctuation">)</span>  <span class="token comment">// destructure the tuple and return the result</span>
  <span class="token operator">|</span><span class="token operator">&gt;</span> renderHTML<span class="token punctuation">;</span>
</code></pre></div><h3 id="有时异常也有用途"><a href="#有时异常也有用途" class="header-anchor">#</a> 有时异常也有用途</h3> <p>异常仍然在开发中占有一席之地。一个简单的原则是你来问自己一个问题——我是否能接受程序崩溃？抛出的任何异常都可能摧毁整个流程。就算我们仔细考虑了所有极端情况，异常仍然是不安全的，迟早让程序崩溃。只有在你能接受程序崩溃时才抛出异常，比如说开发者错误或数据库连接失败等。</p> <p>所谓异常，只应该用在出现例外情况，程序别无选择只能崩溃的时候。为了控制执行流程应该尽量避免抛出和捕获异常。</p> <h3 id="让它崩溃-避免捕获异常"><a href="#让它崩溃-避免捕获异常" class="header-anchor">#</a> 让它崩溃——避免捕获异常</h3> <p>于是就可以总结出处理错误的终极规则——避免捕获异常。如果我们打算让程序崩溃就可以抛出错误，但永远不应该捕获这些错误。这也是 Haskell 和 Elixir 等函数式语言推荐的方法。</p> <p>唯一例外是使用第三方 API 的情况。即使在这种情况下也最好还是使用包装函数的辅助函数来返回 [error，result] 元组代替异常。你可以使用像 saferr 这样的工具。</p> <p>问问自己谁应该对错误负责。如果答案是用户，则应该正常处理错误。我们应该向用户显示友好的消息，而不是什么 500 内部服务器错误。</p> <p>可惜这里没有 no-try-catch ESLint 规则。最接近的是 no-throw 规则。出现特殊情况时，你抛出异常就应该预料到程序的崩溃。</p> <p>建议的 ESLint 配置：</p> <div class="language- extra-class"><pre class="language-text"><code>rules:
  fp/no-throw: warn
</code></pre></div><h2 id="部分应用函数"><a href="#部分应用函数" class="header-anchor">#</a> 部分应用函数</h2> <p>部分应用函数（Partial function application）可能是史上最佳的代码共享机制之一。它摆脱了 OOP 依赖注入。你无需使用典型的 OOP 样板也能在代码中注入依赖项。</p> <p>以下示例包装了因抛出异常（而不是返回失败的响应）而臭名昭著的 Axios 库）。这些库根本没必要，尤其是在使用 async/await 时。</p> <p>下面的例子中我们使用 currying 和部分应用函数来保证一个不安全函数的安全性。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Wrapping axios to safely call the api without throwing exceptions</span>
<span class="token keyword">const</span> <span class="token function-variable function">safeApiCall</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> url<span class="token punctuation">,</span> method <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span>
  <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token punctuation">,</span> method<span class="token punctuation">,</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">,</span> result<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Partially applying the generic function above to work with the users api</span>
<span class="token keyword">const</span> createUser <span class="token operator">=</span> <span class="token function">safeApiCall</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url<span class="token operator">:</span> <span class="token string">'/api/users'</span><span class="token punctuation">,</span>
  method<span class="token operator">:</span> <span class="token string">'post'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Safely calling the api without worrying about exceptions.</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> user<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  email<span class="token operator">:</span> <span class="token string">'ilya@suzdalnitski.com'</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token string">'Password'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>safeApiCall 函数写为<code>func = (params) =&gt; (data) =&gt; {...}</code>。这是函数式编程中的常用技术，称为 currying；它与部分应用函数关系密切。使用 params 调用时，func 函数返回另一个实际执行作业的函数。换句话说，该函数部分应用了 params。</p></div> <p>它也可以写成：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
   <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>依赖项（params）作为第一个参数传递，实际数据作为第二个参数传递。</p></div> <p>为了简化操作你可以使用 saferr npm 包，它也适用于 promise 和 async/await：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> saferr <span class="token keyword">from</span> <span class="token string">'saferr'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> safeGet <span class="token operator">=</span> <span class="token function">saferr</span><span class="token punctuation">(</span>axios<span class="token punctuation">.</span>get<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">testAsync</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token parameter">url</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>err<span class="token punctuation">,</span> result<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">safeGet</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// prints: zdenka.dieckmann@example.com</span>
<span class="token function">testAsync</span><span class="token punctuation">(</span><span class="token string">'https://randomuser.me/api/?results=1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// prints: Network Error</span>
<span class="token function">testAsync</span><span class="token punctuation">(</span><span class="token string">'https://shmoogle.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="几个小技巧"><a href="#几个小技巧" class="header-anchor">#</a> 几个小技巧</h2> <p>列举一些方便的小技巧。它们不一定让代码更可靠，但可以让我们的工作更轻松。有些技巧广为人知，有些不然。</p> <h3 id="来一点类型安全"><a href="#来一点类型安全" class="header-anchor">#</a> 来一点类型安全</h3> <p>JavaScript 不是静态类型语言。但我们可以按需标记函数参数来使代码更加健壮。下面的代码中，所需的值没能传入时将抛出错误。请注意它不适用于空值，但仍然可以很好地防范未定义的值。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">req</span> <span class="token operator">=</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The value </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is required.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> doStuff <span class="token operator">=</span> <span class="token punctuation">(</span> stuff <span class="token operator">=</span> <span class="token function">req</span><span class="token punctuation">(</span><span class="token string">'stuff'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="短路条件和评估"><a href="#短路条件和评估" class="header-anchor">#</a> 短路条件和评估</h3> <p>大家都熟悉短路条件，它能用来访问嵌套对象中的值。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">getUserCity</span> <span class="token operator">=</span> <span class="token parameter">user</span> <span class="token operator">=&gt;</span> user <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>address <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>address<span class="token punctuation">.</span>city<span class="token punctuation">;</span>
<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  address<span class="token operator">:</span> <span class="token punctuation">{</span>
    city<span class="token operator">:</span> <span class="token string">'San Francisco'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Returns &quot;San Francisco&quot;</span>
<span class="token function">getUserCity</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Both return undefined</span>
<span class="token function">getUserCity</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getUserCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果值为虚值（falsey），那么短路评估可以用来提供替代值：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> userCity <span class="token operator">=</span> <span class="token function">getUserCity</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'Detroit'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="赋值两次"><a href="#赋值两次" class="header-anchor">#</a> 赋值两次</h3> <p>给值赋值两次可以将任何值转换为布尔值。请注意，任何虚值都将转换为 false，这可能并不总是你想要的。数字绝不能这样做，因为 0 也将被转换为 false。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">shouldShowTooltip</span> <span class="token operator">=</span> <span class="token parameter">text</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token operator">!</span>text<span class="token punctuation">;</span>
<span class="token comment">// returns true</span>
<span class="token function">shouldShowTooltip</span><span class="token punctuation">(</span><span class="token string">'JavaScript rocks'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// all return false</span>
<span class="token function">shouldShowTooltip</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">shouldShowTooltip</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">shouldShowTooltip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="使用现场日志来调试"><a href="#使用现场日志来调试" class="header-anchor">#</a> 使用现场日志来调试</h3> <p>我们可以利用短路和 console.log 的虚值输出来调试函数代码，甚至 React 组件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">||</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">User</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> email<span class="token punctuation">,</span> name <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Email value<span class="token operator">=</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'email'</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span> <span class="token operator">||</span> email<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Name value<span class="token operator">=</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token operator">||</span> name<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>你真的需要代码可靠性吗？答案取决于你自己的决定。你的组织是否认为开发者的效率取决于完成的 JIRA 故事？你们是不是所谓的函数工厂，工作只是生产更多的函数？如果是这样的话还是换个工作吧。</p> <p>本文的内容在实践中非常有用，值得反复阅读。好好看看这些技巧，ESLint 规则也都试一试吧。</p> <p>英文原文:
<a href="https://medium.com/better-programming/js-reliable-fdea261012ee" target="_blank" rel="noopener noreferrer">https://medium.com/better-programming/js-reliable-fdea261012ee<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://mp.weixin.qq.com/s/fQ9RhV6903EZEkxFD6Es9g" target="_blank" rel="noopener noreferrer">JS 代码脏乱差？你需要知道这些优化技巧<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div></div></div> <div id="shangfang" class="column no-pad-r sm-25 xl-33 xsNone smNone post-sidebar"><div class="ads-container"><!----></div> <!----> <div id="zhongjian"><div class="table-contents-fixed"><h3 id="table-of-content" class="table-contents__title">浮动目录</h3> <nav><ol class="table-contents__list"></ol></nav></div></div></div> <aside id="dibujuli" class="column xs-100"><hr class="divider"> <div><div class="observer" data-v-e3cf7e50><!----> <!----> <!----></div></div> <hr class="divider"> <section class="post-content__disqus"><!----></section></aside></div></section></article></div> <section class="row section-newsletter justify-center newsletter-post-wrap"><div class="column sm-100 md-67 xl-50"><div class="newsletter not-black"><span class="meta-text meta-text--primary not-black">关注我们</span> <h2 class="newsletter__title not-black">在收件箱接收新的内容推送</h2> <form method="post" action="https://luzhaoyang.us4.list-manage.com/subscribe/post?u=1de83ba90307cf0e38650d622&amp;amp;id=04aeba270a" class="newsletter__form not-black"><label for="email_news-1587297372465" class="newsletter__label not-black"><input type="email" name="EMAIL" id="email_news-1587297372465" required="required" placeholder="在这里输入您的电子邮件" autocomplete="off" aria-label="在这里输入您的电子邮件" value="" class="ui-input-field reset-input newsletter__input"></label> <button type="submit" class="ui-button reset-button newsletter__button txt-upper ui-button--primary">
        订阅
      </button></form></div></div></section> <aside class="container main"></aside></div> <!----> <div><div class="elevator"><a class="elevator__link"><span class="icon elevator__icon icon-greaterthan"></span> <!----></a> <!----></div> <div class="mask-container"><div class="mask-wrap"><div class="circle-wrapper"><svg xmlns="http://www.w3.org/200/svg" height="100%" width="100%"><circle cx="66" cy="66" r="55" fill="none" stroke="#FF4437" stroke-width="5" stroke-linecap="round" class="circle-full"></circle> <circle cx="66" cy="66" r="55" fill="none" stroke-width="5" stroke-linecap="round" stroke="#FF4437" stroke-dasharray="0,10000" class="circle-detail"></circle></svg> <img class="mobile-bgm-img coupon-num had-percent"></div> <div></div> <div></div> <div class="mobile-bgm-list"><i class="reco-bgm reco-bgm-last last mobile-bgm-btn"></i> <i class="reco-bgm reco-bgm-pause pause mobile-bgm-btn" style="display:none;"></i> <i class="reco-bgm reco-bgm-play play mobile-bgm-btn" style="display:;"></i> <i class="reco-bgm reco-bgm-next next mobile-bgm-btn"></i></div> <div class="mobile-bgm-close"><i class="iconfont iconLogonClosed mobile-bgm-btn"></i></div></div></div></div> <!----></div></main> <footer id="footer" class="footer "><div class="footer-box1"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1366 161" class="footer-box__shape"><path d="M-11.925-4809v-154.746c40.454,19.75,273.683,130.936,420.544,142.612,161.25,12.821,339.978-42.709,521.543-86.3,169.82-40.769,395.43,29.2,423.912,38.429v60Z" transform="translate(11.926 4970)"></path></svg></div> <div class="footer-box2"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1366 246" class="footer-box__shape"><path d="M-1505.5-4725.5v-238.1c8.149-3.133,18.138-5.059,29.672-5.9h30.954c201.21,11.667,696.6,224.535,855.572,236.458,205.129,15.385,287.179-164.1,432.047-175.625a42.381,42.381,0,0,1,16.756,1.857V-4725.5Z" transform="translate(1506 4971)"></path></svg> <ul class="footer-social__list"></ul> <div class="footer-newsletter not-black"><div class="newsletter not-black"><span class="meta-text meta-text--primary not-black">关注我们</span> <h2 class="newsletter__title not-black">在收件箱接收新的内容推送</h2> <form method="post" action="https://luzhaoyang.us4.list-manage.com/subscribe/post?u=1de83ba90307cf0e38650d622&amp;amp;id=04aeba270a" class="newsletter__form not-black"><label for="email_news-1587297372467" class="newsletter__label not-black"><input type="email" name="EMAIL" id="email_news-1587297372467" required="required" placeholder="在这里输入您的电子邮件" autocomplete="off" aria-label="在这里输入您的电子邮件" value="" class="ui-input-field reset-input newsletter__input"></label> <button type="submit" class="ui-button reset-button newsletter__button txt-upper ui-button--primary">
        订阅
      </button></form></div></div></div> <section class="footer-box3"><div class="row"><div class="column sm-50 footer-card"><div class="observer" data-v-e3cf7e50><div class="spinner observer__spinner" data-v-e3cf7e50><div class="double-bounce1"></div> <div class="double-bounce2"></div></div> <!----> <!----></div></div> <div class="column sm-50 footer-nav"><div class="row justify-right"><div class="column xs-50 sm-40 md-33 footer-nav__box footer-nav__box--1 not-black"><h2 class="meta-text title not-black">我的小窝</h2> <nav class="footer-nav1"><ul><li class="footer-nav1__item"><a href="/zh/categories/" class="not-black">文章分类</a> <!----></li><li class="footer-nav1__item"><a href="/zh/gallery/" class="not-black">摄影相册</a> <!----></li><!----><li class="footer-nav1__item"><a href="/zh/travel/" class="not-black">旅行简记</a> <!----></li><li class="footer-nav1__item"><a href="/zh/about/" class="not-black">关于我们</a> <!----></li><li class="footer-nav1__item"><a href="/zh/contact/" class="not-black">联系我们</a> <!----></li></ul></nav></div> <div class="column xs-50 sm-40 md-33 footer-nav__box footer-nav__box--2"><h2 class="meta-text title not-black">社区</h2> <nav class="footer-nav2"><ul><li class="footer-nav2__item"><!----> <a href="https://jq.qq.com/?_wv=1027&amp;k=5sOoWzp" rel="noopener nofollow" target="_blank" class="not-black">Q群 931024509</a></li><li class="footer-nav2__item"><!----> <a href="https://nativescript-vue-examples.luzhaoyang.com/" rel="noopener nofollow" target="_blank" class="not-black">NSVue 示例</a></li><li class="footer-nav2__item"><!----> <a href="https://marketplace.visualstudio.com/items?itemName=nuochong.nativescript-vue-extend" rel="noopener nofollow" target="_blank" class="not-black">NSVue 扩展</a></li><li class="footer-nav2__item"><!----> <a href="https://luzhaoyang.com/vue-auto-complete/" rel="noopener nofollow" target="_blank" class="not-black">Vue Auto Complete</a></li></ul></nav></div></div></div> <div class="cpolumn sm-100 footer-copy"><p class="visitors-total" data-v-504ab208><span data-v-504ab208>累计访问</span> <span data-v-504ab208></span> <span data-v-504ab208>次</span></p> <p class="footer-copy-last">2018 - 2020 © NUOCHONG - 源于 
  <a href="https://github.com/" rel="noopener" target="_blank">
    GITHUB
  </a></p></div></div> <span class="shapes shapes--circle" style="left: 3%; top: -20%"></span> <span class="shapes shapes--primary shapes--color3" style="left: 30%; top: -15%"></span> <span class="shapes shapes--primary" style="left: 13%; top: -80%; transform: rotate(45deg)"></span> <span class="shapes shapes--circle shapes--color4" style="left: 40%; top: 200px"></span> <span class="shapes shapes--primary" style="left: 15%; bottom: 10%; transform: rotate(75deg)"></span> <span class="shapes shapes--circle shapes--color3" style="right: 50%; top: 30%"></span> <span class="shapes shapes--primary" style="right: 20%; top: -100%"></span> <span class="shapes shapes--circle" style="right: 10%; top: -20%"></span> <span class="shapes shapes--color4" style="right: 35%; top: -20%; transform: rotate(45deg)"></span> <span class="shapes shapes--circle" style="left: 40%; top: -50%"></span> <span class="shapes shapes--color3" style="right: 30%; top: 20%"></span> <span class="shapes shapes--circle shapes--primary" style="right: 30%; bottom: 20%"></span></section></footer></div> <!----> <!----></div><div class="global-ui"><div><!----> <!----></div><!----></div></div>
    <script src="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/app.d57c347f.js" defer></script><script src="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/20.d51247cd.js" defer></script><script src="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/4.2b333221.js" defer></script><script src="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/19.ddff1d59.js" defer></script><script src="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/18.34573ff4.js" defer></script><script src="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/26.41ac749a.js" defer></script><script src="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/0.97d58b67.js" defer></script><script src="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/5.18be1cd5.js" defer></script><script src="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/3.833a573c.js" defer></script><script src="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/23.d4bf616e.js" defer></script><script src="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/79.5042282d.js" defer></script><script src="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/6.4751d3a1.js" defer></script><script src="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/13.1bfcb06f.js" defer></script><script src="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/1.c9ab3064.js" defer></script><script src="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/11.4fde8942.js" defer></script><script src="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/21.fb3560a3.js" defer></script><script src="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/2.245fd20f.js" defer></script><script src="https://cdn.jsdelivr.net/gh/nuochong/nuochong.github.io@v1.0/assets/js/27.fe9fba84.js" defer></script>
  </body>
</html>
